<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>Sample QUAIL plugin with aloha editor</title>
	<link rel="stylesheet" href="alohaeditor/aloha/demo/simple/index.css" type="text/css">
	<link rel="stylesheet" href="alohaeditor/aloha/css/aloha.css" type="text/css">
	<link rel="stylesheet" href="../common/style.css"/>
	<script src="alohaeditor/aloha/lib/require.js"></script>
	<script src="alohaeditor/aloha/lib/vendor/jquery-1.7.2.js"></script>
	<script src="alohaeditor/aloha/lib/aloha.js" data-aloha-plugins="common/ui,common/format,common/highlighteditables,common/link"></script>
	<script src="../../src/quail.js"></script>
</head>
<body>
	<div id="main">
		<div id="content"><p>Here is a picture of my dog, Kogepan:</p>
		<p>
		  <img src="../common/kogepan.png">
		</p>
		<p>
		  I should really use an ABBR tag in this paragraph because QUAIL is an acronym.
		</p>
		</div>
	</div>
	<script type="text/javascript">
	
	Aloha.ready( function() { 
		var accessibilityTests = {
      "imgHasAlt": {
          "type": "selector",
          "selector": "img:not(img[alt])",
          "severity": "severe",
          "title" : "This image is missing an alt text."
      },      
      "documentAbbrIsUsed": {
          "type": "custom",
          "callback": "documentAbbrIsUsed",
          "severity": "moderate",
          "title" : "You need to add an abbreviation tag here."
      },
    };
		Aloha.jQuery('#content').aloha();
		
		var checkContent = function(event) {
  		$('.aloha-editable-active').quail({ guideline : [ 'imgHasAlt', 'documentAbbrIsUsed' ],
	                    jsonPath : '../../src/resources',
	                    accessibilityTests : accessibilityTests,
	                    testFailed : function(event) {
  	                    
  	                    if(event.testName == 'documentAbbrIsUsed') {
    	                    event.element.html(event.element.html().replace(event.options.acronym, '<span class="quail-result moderate" title="' + accessibilityTests.documentAbbrIsUsed.title +'">' + event.options.acronym + '</span>'));
  	                    }
  	                    else {
    	                    event.element.addClass('quail-result')
  	                           .addClass(event.severity)
  	                           .attr('title', accessibilityTests[event.testName].title);
  	                    }
	                    }});
		};
		
		Aloha.bind('aloha-smart-content-changed', checkContent);
		Aloha.bind('aloha-editable-activated', checkContent);
		Aloha.bind('aloha-editable-deactivated', function(editable) {
  		$('.aloha-editable .quail-result').each(function() {
    		$(this).removeClass('quail-result')
    		       .removeClass('severe');
  		});
		});
	});
	</script>
</body>
</html>