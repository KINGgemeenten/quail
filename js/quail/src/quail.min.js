/*! QUAIL quail-lib.org | quail-lib.org/license */(function(e){e.fn.quail=function(e){if(!this.length)return this;t.options=e;t.html=this;t.run();return this};var t={options:{},testCallbacks:{placeholder:"placeholderTest",label:"labelTest",header:"headerOrderTest",event:"scriptEventTest",labelProximity:"labelProximityTest",color:"colorTest"},run:function(){t.options.reset&&(t.accessibilityResults={});typeof t.options.accessibilityTests!="undefined"?t.accessibilityTests=t.options.accessibilityTests:e.ajax({url:t.options.jsonPath+"/tests.json",async:!1,dataType:"json",success:function(e){typeof e=="object"&&(t.accessibilityTests=e)}});typeof t.options.guideline=="string"&&e.ajax({url:t.options.jsonPath+"/guidelines/"+t.options.guideline+".json",async:!1,dataType:"json",success:function(e){t.options.guideline=e}});t.runTests();if(typeof t.options.complete!="undefined"){var n={totals:{severe:0,moderate:0,suggestion:0},results:t.accessibilityResults};e.each(n.results,function(e,r){n.totals[t.accessibilityTests[e].severity]+=r.length});t.options.complete(n)}},testFails:function(e,n,r){r=r||{};t.accessibilityResults[e].push(n);if(typeof t.options.testFailed!="undefined"){var i=typeof t.accessibilityTests[e].severity!="undefined"?t.accessibilityTests[e].severity:"unknown";t.options.testFailed({element:n,testName:e,severity:i,options:r})}},runTests:function(){e.each(t.options.guideline,function(n,r){var i=t.accessibilityTests[r].type;typeof t.accessibilityResults[r]=="undefined"&&(t.accessibilityResults[r]=[]);i==="selector"&&t.html.find(t.accessibilityTests[r].selector).each(function(){t.testFails(r,e(this))});i==="custom"&&typeof t[t.accessibilityTests[r].callback]!="undefined"&&t[t.accessibilityTests[r].callback]();typeof t[t.testCallbacks[i]]!="undefined"&&t[t.testCallbacks[i]](r,t.accessibilityTests[r])})},isUnreadable:function(e){return typeof e!="string"?!0:e.trim().length?!1:!0},isDataTable:function(e){return e.find("th").length&&e.find("tr").length>2?!0:!1},html:{},strings:{},accessibilityResults:{},accessibilityTests:{},loadTests:function(){},validURL:function(e){return e.search(" ")===-1?!0:!1},loadString:function(n){if(typeof t.strings[n]!="undefined")return t.strings[n];e.ajax({url:t.options.jsonPath+"/strings/"+n+".json",async:!1,dataType:"json",success:function(e){t.strings[n]=e}});return t.strings[n]},cleanString:function(e){return e.toLowerCase().replace(/^\s\s*/,"")},loadHasEventListener:function(){e.ajax({url:t.options.jsonPath+"/../jquery/jquery.hasEventListener/jQuery.hasEventListener-2.0.3.min.js",async:!1,dataType:"script"})},placeholderTest:function(n,r){t.loadString("placeholders");t.html.find(r.selector).each(function(){var i;if(typeof r.attribute!="undefined"){if(typeof e(this).attr(r.attribute)=="undefined"||r.attribute==="tabindex"&&!e(this).attr(r.attribute)){t.testFails(n,e(this));return}i=e(this).attr(r.attribute)}else i=e(this).text();if(typeof i=="string"){i=t.cleanString(i);var s=/^([0-9]*)(k|kb|mb|k bytes|k byte)$/g,o=s.exec(i.toLowerCase());o&&o[0].length?t.testFails(n,e(this)):r.empty&&t.isUnreadable(i)?t.testFails(n,e(this)):t.strings.placeholders.indexOf(i)>-1&&t.testFails(n,e(this))}else r.empty&&typeof i!="number"&&t.testFails(n,e(this))})},labelProximityTest:function(n,r){t.html.find(r.selector).each(function(){var r=t.html.find("label[for="+e(this).attr("id")+"]").first();r.length||t.testFails(n,e(this));e(this).parent().is(r.parent())||t.testFails(n,e(this))})},textStatistics:{cleanText:function(e){return e.replace(/[,:;()\-]/," ").replace(/[\.!?]/,".").replace(/[ ]*(\n|\r\n|\r)[ ]*/," ").replace(/([\.])[\. ]+/,"$1").replace(/[ ]*([\.])/,"$1").replace(/[ ]+/," ").toLowerCase()},sentenceCount:function(e){var t=e;return t.split(".").length+1},wordCount:function(e){var t=e;return t.split(" ").length+1},averageWordsPerSentence:function(e){return t.textStatistics.wordCount(e)/t.textStatistics.sentenceCount(e)},averageSyllablesPerWord:function(n){var r=0,i=t.textStatistics.wordCount(n);if(!i)return 0;e.each(n.split(" "),function(e,n){r+=t.textStatistics.syllableCount(n)});return r/i},syllableCount:function(e){var t=e.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/,"").match(/[aeiouy]{1,2}/g);return!t||t.length===0?1:t.length}},colorTest:function(n,r){if(r.bodyForegroundAttribute&&r.bodyBackgroundAttribute){var i=t.html.find("body").clone(!1,!1),s=i.attr(r.bodyForegroundAttribute),o=i.attr(r.bodyBackgroundAttribute);typeof s=="undefined"&&(s="rgb(0,0,0)");typeof o=="undefined"&&(s="rgb(255,255,255)");i.css("color",s);i.css("background-color",o);(r.algorithm==="wcag"&&!t.colors.passesWCAG(i)||r.algorithm==="wai"&&!t.colors.passesWAI(i))&&t.testFails(n,i)}t.html.find(r.selector).find("*").each(function(){(r.algorithm==="wcag"&&!t.colors.passesWCAG(e(this))||r.algorithm==="wai"&&!t.colors.passesWAI(e(this)))&&t.testFails(n,e(this))})},scriptEventTest:function(n,r){typeof jQuery.hasEventListener=="undefined"&&t.loadHasEventListener();var i=typeof r.selector=="undefined"?t.html.find("body").find("*"):t.html.find(r.selector);i.each(function(){var i=e(this).get(0);e(this).attr(r.searchEvent)?(typeof r.correspondingEvent=="undefined"||!e(this).attr(r.correspondingEvent))&&t.testFails(n,e(this)):e.hasEventListener(i,r.searchEvent.replace("on",""))&&(typeof r.correspondingEvent=="undefined"||!e.hasEventListener(i,r.correspondingEvent.replace("on","")))&&t.testFails(n,e(this))})},labelTest:function(n,r){t.html.find(r.selector).each(function(){!e(this).parent("label").length&&!t.html.find("label[for="+e(this).attr("id")+"]").length&&t.testFails(n,e(this))})},containsReadableText:function(n,r){if(!t.isUnreadable(n.text()))return!0;if(!t.isUnreadable(n.attr("alt")))return!0;if(r){var i=!1;n.find("*").each(function(){t.containsReadableText(e(this),!0)&&(i=!0)});if(i)return!0}return!1},headerOrderTest:function(n,r){var i=parseInt(r.selector.substr(-1,1),10),s=!1;t.html.find("h1, h2, h3, h4, h5, h6").each(function(){var r=parseInt(e(this).get(0).tagName.substr(-1,1),10);s&&(r-1>i||r+1<i)&&t.testFails(n,e(this));r===i&&(s=e(this));s&&r!==i&&(s=!1)})},acronymTest:function(n,r){var i={},s={};t.html.find(r+"[title]").each(function(){i[e(this).text().toUpperCase()]=e(this).attr("title")});t.html.find("p, div, h1, h2, h3, h4, h5").each(function(){var r=e(this),o=e(this).text().split(" ");o.length>1&&e(this).text().toUpperCase()!==e(this).text()&&e.each(o,function(e,o){o=o.replace(/[^a-zA-Zs]/,"");if(o.toUpperCase()===o&&o.length>1&&typeof i[o.toUpperCase()]=="undefined"){typeof s[o.toUpperCase()]=="undefined"&&t.testFails(n,r,{acronym:o.toUpperCase()});s[o.toUpperCase()]=o}})})},aAdjacentWithSameResourceShouldBeCombined:function(){t.html.find("a").each(function(){e(this).next("a").attr("href")===e(this).attr("href")&&t.testFails("aAdjacentWithSameResourceShouldBeCombined",e(this))})},aImgAltNotRepetative:function(){t.html.find("a img[alt]").each(function(){t.cleanString(e(this).attr("alt"))===t.cleanString(e(this).parent("a").text())&&t.testFails("aImgAltNotRepetative",e(this).parent("a"))})},aLinksAreSeperatedByPrintableCharacters:function(){t.html.find("a").each(function(){e(this).next("a").length&&t.isUnreadable(e(this).get(0).nextSibling.wholeText)&&t.testFails("aLinksAreSeperatedByPrintableCharacters",e(this))})},aLinkTextDoesNotBeginWithRedundantWord:function(){var n=t.loadString("redundant");t.html.find("a").each(function(){var r=e(this),i="";e(this).find("img[alt]").length&&(i+=e(this).find("img[alt]:first").attr("alt"));i+=e(this).text();i=i.toLowerCase();e.each(n.link,function(e,n){i.search(n)>-1&&t.testFails("aLinkTextDoesNotBeginWithRedundantWord",r)})})},aMustContainText:function(){t.html.find("a").each(function(){!t.containsReadableText(e(this),!0)&&(!e(this).attr("name")||!!e(this).attr("href"))&&t.testFails("aMustContainText",e(this))})},aSuspiciousLinkText:function(){var n=t.loadString("suspicious_links");t.html.find("a").each(function(){n.indexOf(t.cleanString(e(this).text()))>-1&&t.testFails("aSuspiciousLinkText",e(this))})},blockquoteUseForQuotations:function(){t.html.find("p").each(function(){e(this).text().substr(0,1).search(/[\'\"]/)>-1&&e(this).text().substr(-1,1).search(/[\'\"]/)>-1&&t.testFails("blockquoteUseForQuotations",e(this))})},documentAcronymsHaveElement:function(){t.acronymTest("documentAcronymsHaveElement","acronym")},documentAbbrIsUsed:function(){t.acronymTest("documentAbbrIsUsed","abbr")},documentVisualListsAreMarkedUp:function(){var n=[/\*/g,"<br>*","&bull;","&#8226"];t.html.find("p, div, h1, h2, h3, h4, h5, h6").each(function(){var r=e(this);e.each(n,function(e,n){r.text().split(n).length>2&&t.testFails("documentVisualListsAreMarkedUp",r)})})},documentValidatesToDocType:function(){if(typeof document.doctype=="undefined")return},documentIDsMustBeUnique:function(){var n=[];t.html.find("*[id]").each(function(){n.indexOf(e(this).attr("id"))>=0&&t.testFails("documentIDsMustBeUnique",e(this));n.push(e(this).attr("id"))})},documentLangIsISO639Standard:function(){var e=t.loadString("language_codes"),n=t.html.find("html").attr("lang");if(!n)return;e.indexOf(n)===-1&&t.testFails("documentLangIsISO639Standard",t.html.find("html"))},doctypeProvided:function(){e(t.html.get(0).doctype).length===0&&t.testFails("doctypeProvided",t.html.find("html"))},appletContainsTextEquivalent:function(){t.html.find("applet[alt=], applet:not(applet[alt])").each(function(){t.isUnreadable(e(this).text())&&t.testFails("appletContainsTextEquivalent",e(this))})},documentStrictDocType:function(){(!e(t.html.get(0).doctype).length||t.html.get(0).doctype.systemId.indexOf("strict")===-1)&&t.testFails("documentStrictDocType",t.html.find("html"))},embedHasAssociatedNoEmbed:function(){if(t.html.find("noembed").length)return;t.html.find("embed").each(function(){t.testFails("embedHasAssociatedNoEmbed",e(this))})},emoticonsExcessiveUse:function(){var n=t.loadString("emoticons"),r=0;t.html.find("p, div, h1, h2, h3, h4, h5, h6").each(function(){var i=e(this);e.each(i.text().split(" "),function(e,t){n.indexOf(t)>-1&&r++;if(r>4)return});r>4&&t.testFails("emoticonsExcessiveUse",i)})},emoticonsMissingAbbr:function(){var n=t.loadString("emoticons");t.html.find("p, div, h1, h2, h3, h4, h5, h6").each(function(){var r=e(this),i=r.clone();i.find("abbr, acronym").each(function(){e(this).remove()});e.each(i.text().split(" "),function(e,i){n.indexOf(i)>-1&&t.testFails("emoticonsMissingAbbr",r)})})},formWithRequiredLabel:function(){var n=t.loadString("redundant"),r,i=!1;n.required[n.required.indexOf("*")]=/\*/g;t.html.find("label").each(function(){var s=e(this).text().toLowerCase(),o=e(this);e.each(n.required,function(e,n){s.search(n)>=0&&!t.html.find("#"+o.attr("for")).attr("aria-required")&&t.testFails("formWithRequiredLabel",o)});i=o.css("color")+o.css("font-weight")+o.css("background-color");r&&i!==r&&t.testFails("formWithRequiredLabel",o);r=i})},headersUseToMarkSections:function(){t.html.find("p").each(function(){var n=e(this);n.find("strong:first, em:first, i:first, b:first").each(function(){n.text()===e(this).text()&&t.testFails("headersUseToMarkSections",n)})})},imgAltIsDifferent:function(){t.html.find("img[alt][src]").each(function(){(e(this).attr("src")===e(this).attr("alt")||e(this).attr("src").split("/").pop()===e(this).attr("alt"))&&t.testFails("imgAltIsDifferent",e(this))})},imgAltIsTooLong:function(){t.html.find("img[alt]").each(function(){e(this).attr("alt").length>100&&t.testFails("imgAltIsTooLong",e(this))})},inputCheckboxRequiresFieldset:function(){t.html.find(":checkbox").each(function(){e(this).parents("fieldset").length||t.testFails("inputCheckboxRequiresFieldset",e(this))})},inputImageAltIsNotFileName:function(){t.html.find("input[type=image][alt]").each(function(){e(this).attr("src")===e(this).attr("alt")&&t.testFails("inputImageAltIsNotFileName",e(this))})},inputImageAltIsShort:function(){t.html.find("input[type=image]").each(function(){e(this).attr("alt").length>100&&t.testFails("inputImageAltIsShort",e(this))})},inputImageAltNotRedundant:function(){var n=t.loadString("redundant");t.html.find("input[type=image][alt]").each(function(){n.inputImage.indexOf(t.cleanString(e(this).attr("alt")))>-1&&t.testFails("inputImageAltNotRedundant",e(this))})},imgImportantNoSpacerAlt:function(){t.html.find("img[alt]").each(function(){var n=e(this).width()?e(this).width():parseInt(e(this).attr("width"),10),r=e(this).height()?e(this).height():parseInt(e(this).attr("height"),10);t.isUnreadable(e(this).attr("alt").trim())&&e(this).attr("alt").length>0&&n>50&&r>50&&t.testFails("imgImportantNoSpacerAlt",e(this))})},imgAltNotEmptyInAnchor:function(){t.html.find("a img").each(function(){t.isUnreadable(e(this).attr("alt"))&&t.isUnreadable(e(this).parent("a:first").text())&&t.testFails("imgAltNotEmptyInAnchor",e(this))})},imgHasLongDesc:function(){t.html.find("img[longdesc]").each(function(){(e(this).attr("longdesc")===e(this).attr("alt")||!t.validURL(e(this).attr("longdesc")))&&t.testFails("imgHasLongDesc",e(this))})},imgMapAreasHaveDuplicateLink:function(){var n={};t.html.find("a").each(function(){n[e(this).attr("href")]=e(this).attr("href")});t.html.find("img[usemap]").each(function(){var r=e(this),i=t.html.find(r.attr("usemap"));i.length||(i=t.html.find('map[name="'+r.attr("usemap").replace("#","")+'"]'));i.length&&i.find("area").each(function(){typeof n[e(this).attr("href")]=="undefined"&&t.testFails("imgMapAreasHaveDuplicateLink",r)})})},imgGifNoFlicker:function(){t.html.find('img[src$=".gif"]').each(function(){var n=e(this);e.ajax({url:n.attr("src"),async:!1,dataType:"text",success:function(e){e.search("NETSCAPE2.0")!==-1&&t.testFails("imgGifNoFlicker",n)}})})},imgWithMathShouldHaveMathEquivalent:function(){t.html.find("img:not(img:has(math), img:has(tagName))").each(function(){e(this).parent().find("math").length||t.testFails("imgWithMathShouldHaveMathEquivalent",e(this))})},labelMustBeUnique:function(){var n={};t.html.find("label[for]").each(function(){typeof n[e(this).attr("for")]!="undefined"&&t.testFails("labelMustBeUnique",e(this));n[e(this).attr("for")]=e(this).attr("for")})},labelsAreAssignedToAnInput:function(){t.html.find("label").each(function(){e(this).attr("for")?(!t.html.find("#"+e(this).attr("for")).length||!t.html.find("#"+e(this).attr("for")).is("input, select, textarea"))&&t.testFails("labelsAreAssignedToAnInput",e(this)):t.testFails("labelsAreAssignedToAnInput",e(this))})},listNotUsedForFormatting:function(){t.html.find("ol, ul").each(function(){e(this).find("li").length<2&&t.testFails("listNotUsedForFormatting",e(this))})},paragarphIsWrittenClearly:function(){t.html.find("p").each(function(){var n=t.textStatistics.cleanText(e(this).text());Math.round(206.835-1.015*t.textStatistics.averageWordsPerSentence(n)-84.6*t.textStatistics.averageSyllablesPerWord(n))<60&&t.testFails("paragarphIsWrittenClearly",e(this))})},tabIndexFollowsLogicalOrder:function(){var n=0;t.html.find("[tabindex]").each(function(){parseInt(e(this).attr("tabindex"),10)>=0&&parseInt(e(this).attr("tabindex"),10)!==n+1&&t.testFails("tabIndexFollowsLogicalOrder",e(this));n++})},tableLayoutHasNoSummary:function(){t.html.find("table[summary]").each(function(){!t.isDataTable(e(this))&&!t.isUnreadable(e(this).attr("summary"))&&t.testFails("tableLayoutHasNoSummary",e(this))})},tableLayoutHasNoCaption:function(){t.html.find("table:has(caption)").each(function(){t.isDataTable(e(this))||t.testFails("tableLayoutHasNoCaption",e(this))})},tableHeaderLabelMustBeTerse:function(){t.html.find("th, table tr:first td").each(function(){e(this).text().length>20&&(!e(this).attr("abbr")||e(this).attr("abbr").length>20)&&t.testFails("tableHeaderLabelMustBeTerse",e(this))})},tableLayoutMakesSenseLinearized:function(){t.html.find("table").each(function(){t.isDataTable(e(this))||t.testFails("tableLayoutMakesSenseLinearized",e(this))})},tableLayoutDataShouldNotHaveTh:function(){t.html.find("table:has(th)").each(function(){t.isDataTable(e(this))||t.testFails("tableLayoutDataShouldNotHaveTh",e(this))})},tableSummaryDoesNotDuplicateCaption:function(){t.html.find("table[summary]:has(caption)").each(function(){t.cleanString(e(this).attr("summary"))===t.cleanString(e(this).find("caption:first").text())&&t.testFails("tableSummaryDoesNotDuplicateCaption",e(this))})},tableUsesAbbreviationForHeader:function(){t.html.find("th:not(th[abbr])").each(function(){e(this).text().length>20&&t.testFails("tableUsesAbbreviationForHeader",e(this))})},tableUseColGroup:function(){t.html.find("table").each(function(){t.isDataTable(e(this))&&!e(this).find("colgroup").length&&t.testFails("tableUseColGroup",e(this))})},tableWithMoreHeadersUseID:function(){t.html.find("table:has(th)").each(function(){var n=e(this),r=0;n.find("tr").each(function(){e(this).find("th").length&&r++;r>1&&!e(this).find("th[id]").length&&t.testFails("tableWithMoreHeadersUseID",n)})})},preShouldNotBeUsedForTabularLayout:function(){t.html.find("pre").each(function(){var n=e(this).text().split(/[\n\r]+/);n.length>1&&e(this).text().search(/\t/)>-1&&t.testFails("preShouldNotBeUsedForTabularLayout",e(this))})},siteMap:function(){var n=t.loadString("site_map"),r=!0;t.html.find("a").each(function(){var t=e(this).text().toLowerCase();e.each(n,function(e,n){if(t.search(n)>-1){r=!1;return}});if(r===!1)return});r&&t.testFails("siteMap",t.html.find("body"))},suspectPHeaderTags:["strong","b","em","i","u","font"],suspectPCSSStyles:["color","font-weight","font-size","font-family"],tabularDataIsInTable:function(){t.html.find("pre").each(function(){e(this).html().search("	")>=0&&t.testFails("tabularDataIsInTable",e(this))})},pNotUsedAsHeader:function(){var n={};t.html.find("p").each(function(){if(e(this).text().search(".")<1){var r=e(this);e.each(t.suspectPHeaderTags,function(n,i){r.find(i).length&&r.find(i).each(function(){e(this).text().trim()===r.text().trim()&&t.testFails("pNotUsedAsHeader",r)})});e.each(t.suspectPCSSStyles,function(e,i){typeof n[i]!="undefined"&&n[i]!==r.css(i)&&t.testFails("pNotUsedAsHeader",r);n[i]=r.css(i)});r.css("font-weight")==="bold"&&t.testFails("pNotUsedAsHeader",r)}})},documentTitleIsShort:function(){t.html.find("head title:first").text().length>150&&t.testFails("documentTitleIsShort",t.html.find("head title:first"))}};t.colors={getLuminosity:function(e,n){e=t.colors.cleanup(e);n=t.colors.cleanup(n);var r=e.r/255,i=e.g/255,s=e.b/255,o=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),u=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),a=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),f=n.r/255,l=n.g/255,c=n.b/255,h=f<=.03928?f/12.92:Math.pow((f+.055)/1.055,2.4),p=l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4),d=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4),v,m;if(e.r+e.g+e.b<=n.r+n.g+n.b){m=.2126*o+.7152*u+.0722*a;v=.2126*h+.7152*p+.0722*d}else{v=.2126*o+.7152*u+.0722*a;m=.2126*h+.7152*p+.0722*d}return Math.round((v+.05)/(m+.05),2)},passesWCAG:function(e){return t.colors.getLuminosity(t.colors.getColor(e,"foreground"),t.colors.getColor(e,"background"))>5},passesWAI:function(e){var n=t.colors.cleanup(t.colors.getColor(e,"foreground")),r=t.colors.cleanup(t.colors.getColor(e,"background"));return t.colors.getWAIErtContrast(n,r)>500&&t.colors.getWAIErtBrightness(n,r)>125},getWAIErtContrast:function(e,n){var r=t.colors.getWAIDiffs(e,n);return r.red+r.green+r.blue},getWAIErtBrightness:function(e,n){var r=t.colors.getWAIDiffs(e,n);return(r.red*299+r.green*587+r.blue*114)/1e3},getWAIDiffs:function(e,t){var n={};n.red=Math.abs(e.r-t.r);n.green=Math.abs(e.g-t.g);n.blue=Math.abs(e.b-t.b);return n},getColor:function(e,t){return t==="foreground"?e.css("color")?e.css("color"):"rgb(255,255,255)":e.css("background-color")?e.css("background-color"):"rgb(0,0,0)"},cleanup:function(e){e=e.replace("rgb(","").replace("rgba(","").replace(")","").split(",");return{r:e[0],g:e[1],b:e[2],a:typeof e[3]=="undefined"?!1:e[3]}}}})(jQuery);